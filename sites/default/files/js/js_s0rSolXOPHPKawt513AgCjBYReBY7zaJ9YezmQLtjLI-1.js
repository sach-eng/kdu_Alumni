/* @license GPL-2.0-or-later https://www.drupal.org/licensing/faq */
ServiceOverlay.prototype=new google.maps.OverlayView();function ServiceOverlay(type,latlng,txt,map){this.type_=type;this.latlng_=latlng;this.txt_=txt;this.map_=map;this.div_=null;this.inner_=null;this.setMap(map);this.sizeX=240;this.sizeY=82;}ServiceOverlay.prototype.onAdd=function(){var div=document.createElement('DIV');div.className='map-popup '+this.type_;var inner=document.createElement('DIV');inner.className='inner';inner.innerHTML=this.txt_;div.appendChild(inner);this.div_=div;this.inner_=inner;var panes=this.getPanes();panes.floatPane.appendChild(this.div_);};ServiceOverlay.prototype.setType=function(t){this.type_=t;this.div_.className='map-popup '+this.type_;};ServiceOverlay.prototype.draw=function(){var overlayProjection=this.getProjection();var pos=overlayProjection.fromLatLngToDivPixel(this.latlng_);var pos_in_container=overlayProjection.fromLatLngToContainerPixel(this.latlng_);var mapdiv=this.map_.getDiv();var mapY=mapdiv.offsetHeight;var mapX=mapdiv.offsetWidth;var top=0;var left=0;var halfy=(mapY/2);if(pos_in_container.y>halfy)top=pos.y-this.sizeY-50;else top=pos.y+5;var offsetX=pos_in_container.x-(this.sizeX/2);if(offsetX<10)offsetX=10+(this.sizeX/2)-pos_in_container.x;else{if((offsetX+this.sizeX)>mapX)offsetX=mapX-this.sizeX-10;}left=pos.x-Math.abs(pos_in_container.x-offsetX);this.div_.style.top=top+"px";this.div_.style.left=left+"px";};ServiceOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_);};ServiceOverlay.prototype.setLatlng=function(latlng){this.latlng_=latlng;this.draw();};ServiceOverlay.prototype.setTxt=function(txt){this.txt_=txt;this.inner_.innerHTML=this.txt_;};ServiceOverlay.prototype.hide=function(){if(this.div_)this.div_.style.visibility="hidden";};ServiceOverlay.prototype.show=function(){if(this.div_)this.div_.style.visibility="visible";};ServiceOverlay.prototype.toggle=function(){if(this.div_)if(this.div_.style.visibility=="hidden")this.show();else this.hide();};ServiceOverlay.prototype.toggleDOM=function(){if(this.getMap())this.setMap(null);else this.setMap(this.map_);};ServiceOverlay.prototype.autopan=function(top,left){var bottom=top+this.sizeY;var right=left+this.sizeX;var mapHeight=this.map_.getDiv().offsetHeight;var mapWidth=this.map_.getDiv().offsetWidth;var deltaX=0;var deltaY=0;if(right>mapWidth)deltaX=right-mapWidth+40;if(top<0)deltaY=top+30;else{if(bottom>mapHeight)deltaY=bottom-mapHeight+30;}if(deltaX!=0||deltaY!=0)this.map_.panBy(deltaX,deltaY);};var AheduMap={imgpath:'/themes/custom/ahedu2020/images/',markerImages:new Array(),infowindow:null,currentmap:null,popup:null,isShowPopup:true,_getImage:function(type){return "trip_marker_"+type+"_d.png";},getMarkerImage:function(type){var m=this.markerImages[type];if(m==null){m=new google.maps.MarkerImage(this.imgpath+this._getImage(type),new google.maps.Size(20,22),new google.maps.Point(0,0),new google.maps.Point(20,22));this.markerImages[type]=m;}return m;},createMarker:function(service,canvasElement){var latlng=new google.maps.LatLng(service.lat,service.lng);var marker;var zindex=1;if(typeof (service.zindex)!=='undefined'&&service.zindex!='')zindex=parseInt(service.zindex);if(service.type=='Club'||service.type=='SIG')marker=new google.maps.Marker({position:latlng,map:this.currentmap,cursor:'pointer',zIndex:zindex,icon:AheduMap.getMarkerImage(service.type+'_'+service.status)});else if(this.isShowPopup)marker=new google.maps.Marker({position:latlng,map:this.currentmap,cursor:'pointer',zIndex:zindex,icon:AheduMap.getMarkerImage(service.type)});else marker=new google.maps.Marker({position:latlng,map:this.currentmap,cursor:'text',zIndex:zindex,icon:AheduMap.getMarkerImage(service.type)});marker.set('service',service);if(this.isShowPopup){google.maps.event.addListener(marker,'mouseover',function(){AheduMap.showPopup(marker.getPosition(),marker.get('service'));});google.maps.event.addListener(marker,'mouseout',function(){AheduMap.hidePopup();});}else google.maps.event.removeListener(marker,'click');if(canvasElement!="map_canvas_single"){var comp=new RegExp(location.host);if(comp.test(service.link))link_type='Click';else link_type='OffsiteClick';google.maps.event.addListener(marker,'click',function(){console.log(service.link.replace("\/","/"));window.location=service.link.replace("\/","/");});}},createPolyLines:function(services){var tripPlanCoordinates=new Array();var j=0;var latLng;for(var i=0;i<services.length;i++)if(services[i]&&services[i].type!='club_event'&&services[i].type!='haa_event'){latLng=new google.maps.LatLng(services[i].lat,services[i].lng);tripPlanCoordinates[j]=latLng;j++;}if(tripPlanCoordinates.length>1){var tripPath=new google.maps.Polyline({path:tripPlanCoordinates,strokeColor:"#8C8179",strokeOpacity:1.0,strokeWeight:3});tripPath.setMap(this.currentmap);}},showPopup:function(latlng,service){var html='';if(service.type=='Club'||service.type=='SIG')html='<div class="club_title">'+service.name+'</div><div class="club_details">'+service.country+'</div>';else{var name='';if(service.external_link=='yes')name='<span class="external_link">'+service.name+'</span>';else name='<span>'+service.name+'</span>';html='<div class="trip_date">'+service.date+'</div><div class="trip_title">'+name+'</div><div class="trip_location">';if(service.street!='')html+=service.street+'<br>';if(service.city!='')html+=service.city+', ';if(service.state!='')html+=service.state+', ';if(service.country!='')html+=service.country+'</div>';else html=html.substring(0,html.length-2)+'</div>';}console.log(html);if(this.popup==null)if(service.type=='Club'||service.type=='SIG')this.popup=new ServiceOverlay(service.type+'-'+service.status,latlng,html,this.currentmap);else this.popup=new ServiceOverlay(service.type,latlng,html,this.currentmap);else{this.popup.setTxt(html);this.popup.setLatlng(latlng);if(service.type=='Club'||service.type=='SIG')this.popup.setType(service.type+'-'+service.status);else this.popup.setType(service.type);this.popup.show();}},hidePopup:function(){if(this.popup!=null)this.popup.hide();},init:function(centerLat,centerLng,zoomLevel,canvasElement,services){var latlng=new google.maps.LatLng(centerLat,centerLng);var myOptions;if(canvasElement=="map_canvas_single")myOptions={zoom:zoomLevel,center:latlng,disableDefaultUI:true,navigationControl:true,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},mapTypeControl:false,scaleControl:true,zoomControl:true,minZoom:1,mapTypeId:google.maps.MapTypeId.ROADMAP};else myOptions={zoom:zoomLevel,center:latlng,disableDefaultUI:false,navigationControl:true,navigationControlOptions:{style:google.maps.NavigationControlStyle.ZOOM_PAN},mapTypeControl:false,streetViewControl:false,scaleControl:false,minZoom:1,mapTypeId:google.maps.MapTypeId.ROADMAP};this.currentmap=new google.maps.Map(document.getElementById(canvasElement),myOptions);for(var i=0;i<services.length;i++)if(services[i])this.createMarker(services[i],canvasElement);if(canvasElement=="map_canvas_single")this.createPolyLines(services);},getCenterAndZoom:function(services){var maxLat=services[0]['lat'],maxLng=services[0]['lng'],minLat=services[0]['lat'],minLng=services[0]['lng'];for(var i=0;i<services.length;i++)if(services[i]){if(services[i]['lat']*1-maxLat*1>0)maxLat=services[i]['lat'];if(services[i]['lat']*1-minLat*1<0)minLat=services[i]['lat'];if(services[i]['lng']*1-maxLng*1>0)maxLng=services[i]['lng'];if(services[i]['lng']*1-minLng*1<0)minLng=services[i]['lng'];}var cenLat=(maxLat*1+minLat*1)/2;var cenLng=(maxLng*1+minLng*1)/2;var mag=maxLng*1-minLng*1;if((maxLat*1-minLat*1)*2>mag)mag=(maxLat*1-minLat*1)*2;var zoom;if((mag*1-120)>0)zoom=1;else if((mag*1-48)>0)zoom=2;else if((mag*1-22)>0)zoom=3;else if((mag*1-12)>0)zoom=4;else if((mag*1-6)>0)zoom=5;else if((mag*1-3)>0)zoom=6;else if((mag*1-1.5)>0)zoom=7;else if((mag*1-0.7)>0)zoom=8;else if((mag*1-0.30)>0)zoom=9;else if((mag*1-0.1)>0)zoom=10;else zoom=11;var centerzoom={cLat:cenLat,cLng:cenLng,zoomLevel:zoom};return centerzoom;}};if(typeof drupalSettings.ahedu2020!=='undefined'&&typeof drupalSettings.ahedu2020.locations_for_map!=='undefined'){var services=drupalSettings.ahedu2020.locations_for_map;if(services.length>0){var centerzoom=AheduMap.getCenterAndZoom(services);if(document.getElementById("map_canvas")!==null)AheduMap.init(centerzoom.cLat,centerzoom.cLng,centerzoom.zoomLevel,"map_canvas",services);if(document.getElementById("map_canvas_single")!==null)AheduMap.init(centerzoom.cLat,centerzoom.cLng,centerzoom.zoomLevel,"map_canvas_single",services);}else{if(document.getElementById("map_canvas")!==null)document.getElementById("map_canvas").style.display="none";if(document.getElementById("map_canvas_single")!==null)document.getElementById("map_canvas_single").style.display="none";}}else{if(document.getElementById("map_canvas")!==null)document.getElementById("map_canvas").style.display="none";if(document.getElementById("map_canvas_single")!==null)document.getElementById("map_canvas_single").style.display="none";};
